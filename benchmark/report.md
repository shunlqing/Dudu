### 网络库性能测试

#### 1. 测试环境

Ubuntu 16.04 虚拟机

CPU核心数 ： 2



#### 2. 测试方法

依据asio性能测试的方法，使用pingpong协议测试网络框架在单机上的吞吐量。

pingpong协议是客户端和服务端都实现echo协议。当TCP连接建立时，客户端向服务器发送一些数据，服务器会echo这些数据，然后客户端再echo回服务器。

测试两种情况下的吞吐量：

1. 客户端和服务端都是单线程，设置不同的块大小和并发连接数。
2. 客户端和服务端为多线程，设置不同的IO线程数和并发连接数。



#### 3. 单线程

单位：Mib/s

| 块大小 \ 并发连接数 | 1    | 10   | 100  | 1000 | 10000 |
| :-----------------: | ---- | ---- | ---- | ---- | ----- |
|        1024         | 8    | 134  | 166  | 117  | 105   |
|        2048         | 17   | 272  | 275  | 207  | 180   |
|        4096         | 35   | 467  | 474  | 332  | 321   |
|        8192         | 69   | 797  | 799  | 639  | 557   |
|        16384        | 132  | 1226 | 1215 | 980  | 703   |
|        81920        | 398  | 1001 | 940  | 897  | 252   |



#### 4. 多线程

服务端和客户端都设置为相应的IO线程数。

数据块大小固定为16384B，单位Mib/s

| 线程数\并发连接数 | 100  | 1000 | 1000 |
| :---------------: | :--: | :--: | :--: |
|         1         | 1153 | 892  | 690  |
|         2         | 1128 | 947  | 667  |
|         3         | 1129 | 955  | 664  |
|         4         | 1135 | 865  | 644  |



#### 5. 几点说明
1. 数据是无格式的，双方都直接将收到的数据echo回去，并不拆包，少了解析包的延迟。
2. 测试虚拟机的核心数为2，客户端和服务端分别跑一个CPU，所以多线程的测试意义不大。从多线程的测试结果看，数据差距不大。
